# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a comprehensive PocketBase MCP (Model Context Protocol) server that enables LLMs to interact with PocketBase instances through standardized tools. It follows the MCP specification to provide access to all major PocketBase functionality.

## Key Dependencies

- `@modelcontextprotocol/sdk`: SDK for implementing the Model Context Protocol
- `pocketbase`: Official JavaScript/TypeScript client for PocketBase
- `zod`: Runtime type validation
- `typescript`: Programming language for type-safe JavaScript

## Project Setup

To set up the project for development:

```bash
# Install dependencies
npm install

# Build the project
npm run build
```

## Development Commands

```bash
# Run in development mode
npm run dev

# Build TypeScript to JavaScript
npm run build

# Run in production mode
npm start
```

## Project Structure

- `src/mcp-server.ts` - Main MCP server implementation with all tool definitions and handlers
- `src/config-loader.ts` - Configuration loading from file/env variables
- `dist/` - Compiled JavaScript output (generated by build)
- `pocketbase/` - PocketBase SDK and documentation directories
- `pocketbase_docs/` - PocketBase documentation for reference

## Environment Variables

- `POCKETBASE_URL`: URL of your PocketBase instance (default: `http://127.0.0.1:8090`)

## MCP Tools Available (60+ tools)

The server exposes comprehensive PocketBase functionality:

### Collection Management
- `list_collections` - List all collections with pagination and filtering
- `get_collection` - Get a specific collection by ID or name
- `create_collection` - Create a new collection with schema
- `update_collection` - Update collection settings and schema
- `delete_collection` - Delete a collection
- `import_collections` - Import multiple collections at once

### Record Management
- `list_records` - List records with filtering, sorting, pagination, and field selection
- `get_full_list` - Get all records without pagination (batch processing)
- `get_first_list_item` - Get the first record matching a filter
- `get_record` - Get a specific record by ID
- `create_record` - Create a new record
- `update_record` - Update an existing record
- `delete_record` - Delete a record

### Batch Operations
- `batch_create` - Create multiple records in one transaction
- `batch_update` - Update multiple records in one transaction
- `batch_delete` - Delete multiple records in one transaction
- `batch_upsert` - Upsert multiple records in one transaction

### Authentication
- `list_auth_methods` - Get available authentication methods
- `auth_with_password` - Authenticate using email/username and password
- `auth_with_oauth2` - Get OAuth2 authentication URL
- `auth_refresh` - Refresh authentication token
- `request_otp` - Request OTP for email authentication
- `auth_with_otp` - Authenticate with OTP
- `request_password_reset` - Send password reset email
- `confirm_password_reset` - Confirm password reset
- `request_verification` - Send verification email
- `confirm_verification` - Confirm email verification
- `request_email_change` - Request email change
- `confirm_email_change` - Confirm email change

### File Management
- `get_file_url` - Generate file URLs with thumbnail/download options
- `get_file_token` - Get private file access token

### Log Management
- `list_logs` - List system logs with filtering
- `get_log` - Get a specific log entry
- `get_log_stats` - Get log statistics

### Cron Jobs
- `list_cron_jobs` - List all cron jobs
- `run_cron_job` - Manually run a cron job

### System
- `get_health` - Check PocketBase health status
- `get_settings` - Get PocketBase settings (requires admin auth)
- `update_settings` - Update settings (requires admin auth)

### Backup Management
- `create_backup` - Create a backup
- `list_backups` - List available backups
- `download_backup` - Get download URL for a backup
- `delete_backup` - Delete a backup
- `restore_backup` - Restore from a backup

### Hook Management
- `list_hooks` - List JavaScript hook files
- `read_hook` - Read hook file contents
- `create_hook` - Create or update a hook file
- `delete_hook` - Delete a hook file
- `create_hook_template` - Generate hook templates

## Usage with Claude Desktop

Add this configuration to your Claude Desktop MCP settings:

```json
{
  "mcpServers": {
    "pocketbase": {
      "command": "node",
      "args": ["/path/to/pocketbase-mcp-server/dist/mcp-server.js"],
      "env": {
        "POCKETBASE_URL": "http://localhost:8090"
      }
    }
  }
}
```

## Important Implementation Notes

### API Alignment
- The implementation follows the official PocketBase JavaScript SDK patterns
- All query parameters match the SDK options (filter, sort, expand, fields, skipTotal, etc.)
- Batch operations use the SDK's batch functionality

### Error Handling
- All tool operations include try-catch blocks
- Errors are returned in a consistent format
- Network and authentication errors are handled gracefully

### Performance Considerations
- `skipTotal` parameter available for better performance on large datasets
- `fields` parameter to limit data transfer
- Batch operations for bulk modifications
- `getFullList` uses configurable batch sizes

### Security
- Admin operations require appropriate authentication
- OAuth2 state handling follows security best practices
- File tokens for private file access

## Coding Guidelines

- Always reference the pocketbase SDK documentation before implementing new features
- Follow the existing tool naming patterns (snake_case for tool names)
- Include proper TypeScript types for all parameters
- Add comprehensive JSDoc comments for each tool implementation
- Test with actual PocketBase instances before releasing

## Version History

- v2.1.0 - Added hook management tools for JavaScript hooks in pb_hooks directory
- v2.0.0 - Major update with 60+ tools, full SDK alignment, batch operations
- v1.0.0 - Initial release with basic CRUD operations